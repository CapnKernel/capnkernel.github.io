<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/">
    <title>Mitch&#x27;s Notes</title>
    <link href="https://capnkernel.github.io/feed.xml" rel="self" />
    <link href="https://capnkernel.github.io" />
    <updated>2025-10-03T15:01:17+10:00</updated>
    <author>
        <name>Mitch</name>
    </author>
    <id>https://capnkernel.github.io</id>

    <entry>
        <title>Planter boxes using corflute and milk crates</title>
        <author>
            <name>Mitch</name>
        </author>
        <link href="https://capnkernel.github.io/planter-boxes-using-corflute-and-milk-crates.html"/>
        <id>https://capnkernel.github.io/planter-boxes-using-corflute-and-milk-crates.html</id>

        <updated>2025-09-23T14:11:32+10:00</updated>
            <summary>
                <![CDATA[
                    (From Jan 2023, we’ve moved since) There’s no soil where we live, just a concrete space. Everything we plant has to be in a container of some sort, and our soil (3m² of it) was shipped in on a truck:
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>(From Jan 2023, we’ve moved since)</p><p>There’s no soil where we live, just a concrete space.  Everything we plant has
to be in a container of some sort, and our soil (3m² of it) was shipped in on
a truck:</p><figure class="post__image"><img src="https://capnkernel.github.io/media/posts/7/planter-boxes-soil-1.jpg" alt="Lots of soil" width="2628" height="1940" sizes="(max-width: 1920px) 100vw, 1920px" srcset="https://capnkernel.github.io/media/posts/7/responsive/planter-boxes-soil-1-xs.jpg 640w ,https://capnkernel.github.io/media/posts/7/responsive/planter-boxes-soil-1-sm.jpg 768w ,https://capnkernel.github.io/media/posts/7/responsive/planter-boxes-soil-1-md.jpg 1024w ,https://capnkernel.github.io/media/posts/7/responsive/planter-boxes-soil-1-lg.jpg 1366w ,https://capnkernel.github.io/media/posts/7/responsive/planter-boxes-soil-1-xl.jpg 1600w ,https://capnkernel.github.io/media/posts/7/responsive/planter-boxes-soil-1-2xl.jpg 1920w"></figure><figure class="post__image"><img loading="lazy" src="/media/posts/7/planter-boxes-soil-1-2.jpg" alt="Image description" width="2628" height="1940" sizes="(max-width: 1920px) 100vw, 1920px" srcset="/media/posts/7/responsive/planter-boxes-soil-1-2-xs.jpg 640w ,/media/posts/7/responsive/planter-boxes-soil-1-2-sm.jpg 768w ,/media/posts/7/responsive/planter-boxes-soil-1-2-md.jpg 1024w ,/media/posts/7/responsive/planter-boxes-soil-1-2-lg.jpg 1366w ,/media/posts/7/responsive/planter-boxes-soil-1-2-xl.jpg 1600w ,/media/posts/7/responsive/planter-boxes-soil-1-2-2xl.jpg 1920w"></figure>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Inventree 1.0.1 install</title>
        <author>
            <name>Mitch</name>
        </author>
        <link href="https://capnkernel.github.io/inventree-100-install.html"/>
        <id>https://capnkernel.github.io/inventree-100-install.html</id>

        <updated>2025-09-23T13:53:30+10:00</updated>
            <summary>
                <![CDATA[
                    Bare metal Installation instructions here: https://docs.inventree.org/en/latest/start/install/ Here’s what I did different: Do the apt-get install of required system packages For Weasyprint: https://doc.courtbouillon.org/weasyprint/stable/first_steps.html apt install pango1.0-tools The rest of what Weasyprint needs will be auto-installed into the venv later. Create user with uid 1118 (to not&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Bare metal Installation instructions here:</p><p>  <a href="https://docs.inventree.org/en/latest/start/install/">https://docs.inventree.org/en/latest/start/install/</a></p><p>Here’s what I did different:</p><h2 id="install-system-packages">Install System Packages</h2>
<p>Do the <code>apt-get install</code> of required system packages<br>For Weasyprint:<br><a href="https://doc.courtbouillon.org/weasyprint/stable/first_steps.html">https://doc.courtbouillon.org/weasyprint/stable/first_steps.html</a><br><code>apt install pango1.0-tools</code><br>The rest of what Weasyprint needs will be auto-installed into the venv later.</p><h2 id="create-inventree-user">Create InvenTree User</h2>
<p>Create user with uid 1118 (to not clash with other uids), which is a member of <code>www-data</code> group.</p><p>Instead of:</p><pre><code>useradd -m -d /home/inventree -s /bin/bash inventree
</code></pre>
<p>… run:</p><pre><code>useradd -m -U -u 1118 -G www-data -s /bin/bash inventree
chown inventree:www-data /home/inventree
chmod o-rwx /home/inventree
</code></pre>
<p>Re <code>su inventree</code>, I installed my own ssh public key:</p><pre><code>[ -f /home/inventree/.ssh/authorized_keys ] || (
  cd /home/inventree
  mkdir --mode 700 .ssh
    chown inventree:inventree .ssh
  cp /home/mjd/.ssh/mjd@xiaomao.afork.com .ssh/
  cat .ssh/*@* | sort | uniq &gt; .ssh/authorized_keys
    chown inventree:inventree .ssh/*
    chmod go-rwx .ssh/authorized_keys
)
</code></pre>
<p>From here on, do everything logged in as the inventree user.</p><h2 id="create-required-directories">Create Required Directories</h2>
<pre><code>cd
mkdir data
cd data
mkdir static media backup
chgrp www-data static media backup
chmod g+s backup media
cd ..
</code></pre>
<h2 id="download-source-code">Download Source Code</h2>
<p>Instead of:</p><pre><code>git clone https://github.com/inventree/inventree src
</code></pre>
<p>… run:</p><pre><code>git clone -b stable https://github.com/inventree/inventree src
</code></pre>
<p>Then: Create and patch config (<code>~/src/config/config.yaml</code>), as follows.</p><p><strong>Note, you’ll need to provide values for anything with a % below.</strong></p><pre><code># Helper function
yaml_set() {
  F=~/src/config/config.yaml
  cp $F $F.tmp; awk -v key=&quot;$1&quot; -v val=&quot;$2&quot; &#39;BEGIN {
      have_dot = index(key, &quot;.&quot;);
      if (have_dot) {
          split(key, parts, &quot;.&quot;)
          parent = parts[1]
          child = parts[2]
      }
  }
  { 
    if (have_dot) {
      if ($0 ~ &quot;^[[:alnum:]_]+:&quot;) in_parent = 0;
      if ($0 ~ &quot;^&quot; parent &quot;:&quot;) in_parent = 1;
      if (in_parent &amp;&amp; match($0, &quot;^([[:space:]]*)(#[[:space:]]*)?(&quot; child &quot;):&quot;, m)) $0 = m[1] m[3] &quot;: &quot; val;
    } else if (patsplit($0, m, &quot;^[[:space:]]*(#[[:space:]]*)?&quot; key &quot;:&quot;)) $0 = key &quot;: &quot; val;
    print
  }&#39; &lt; $F.tmp &gt; $F; rm $F.tmp
}
</code></pre>
<pre><code>ln -sf ../src/backend/InvenTree/config_template.yaml src/config/config.yaml.orig
cp src/config/config.yaml.orig src/config/config.yaml

yaml_set database.ENGINE mysql
yaml_set database.NAME itree
yaml_set database.USER dbuser
yaml_set database.PASSWORD %same-as-for-the-portal

yaml_set site_url https://itree.superlab.au/

yaml_set debug False

yaml_set admin_enabled True
yaml_set admin_url itree-admin
yaml_set admin_user admin
yaml_set admin_email itreeadmin@superhouse.tv
yaml_set admin_password %admin-user-password

yaml_set language en-AU
yaml_set timezone Australia/Melbourne

yaml_set email.sender itree@superlab.au
yaml_set email.host mail.smtp2go.com
yaml_set email.port 2525
yaml_set email.username itree
yaml_set email.password %smtp2go-password

yaml_set plugins_enabled True

yaml_set media_root /home/inventree/data/media
yaml_set static_root /home/inventree/data/static
yaml_set backup_dir /home/inventree/data/backup

yaml_set background.workers 1

yaml_set login_default_protocol https

yaml_set global_settings.INVENTREE_DEFAULT_CURRENCY AUD
</code></pre>
<h2 id="create-virtual-environment">Create Virtual Environment</h2>
<p>As per instructions.</p><h2 id="install-inventree-packages">Install InvenTree Packages</h2>
<p>Instead of:</p><pre><code>pip install --upgrade --ignore-installed invoke
invoke install
</code></pre>
<p>… run:</p><pre><code>cd ~/src
pip install --upgrade --ignore-installed invoke
invoke install --skip-plugins
</code></pre>
<p>If you run <code>invoke</code> and get a message <code>Can&#39;t find any collection named &#39;tasks&#39;!</code>, then you need to run <code>cd ~/src</code> first, because <code>invoke</code> is sensitive to the directory it runs in.</p><p>If you run <code>invoke install</code> and you get this message:</p><pre><code>yaml.scanner.ScannerError: while scanning for the next token
found character &#39;%&#39; that cannot start any token
  in &quot;/home/inventree/src/config/config.yaml&quot;, line 27, column 13
</code></pre>
<p>… then you need to go edit <code>~/etc/config.yaml</code> and patch in the passwords for any line containing <code>%</code>.</p><p><code>--skip-plugins</code> is necessary because without this, the install tries to access the db, which hasn’t been set up yet.</p><h2 id="create-database">Create Database</h2>
<p>Db will be MariaDB.  Follow MySQL / MariaDB section.  Replace this:</p><pre><code>sudo apt-get install mysql-server libmysqlclient-dev
</code></pre>
<p>with</p><pre><code>sudo apt-get install mariadb-server libmysqlclient-dev
</code></pre>
<p>and</p><pre><code>pip3 install mysqlclient mariadb
</code></pre>
<p>with</p><pre><code>pip3 install mysqlclient
</code></pre>
<p>Re the SQL statements, the db I created is called <code>itree</code>, and the db user is <code>dbuser</code> (same as for the portal).  The password will need to match what’s in <code>~/etc/config.yaml</code> (see above).</p><pre><code>sudo mysql -u root
mysql&gt; CREATE DATABASE itree;
mysql&gt; GRANT ALL ON itree.* TO &#39;dbuser&#39;@&#39;%&#39;;
mysql&gt; FLUSH PRIVILEGES;
mysql&gt; EXIT;
</code></pre>
<p><strong>Don’t follow the web page from here on</strong></p><h2 id="initialize-database">Initialize database</h2>
<p><strong>Don’t follow any of this</strong></p><h2 id="and-then">And then…</h2>
<p>This creates the db tables and a bunch of other important setup things.</p><pre><code>invoke update --skip-backup --no-frontend
</code></pre>
<h2 id="download-front-end-react-app-files">Download front end react app files</h2>
<pre><code>TAG=v$(awk &#39;match($0, &quot;^INVENTREE_SW_VERSION = \047(.*)\047&quot;, m) {print m[1]}&#39; &lt; ./src/backend/InvenTree/InvenTree/version.py)
mkdir ~/src/src/backend/InvenTree/web/static
invoke frontend-download --tag $TAG
invoke static
</code></pre>
<h2 id="worker-service">Worker service</h2>
<p>Inventree has a backend worker for operations that can take time, such as generating reports and sending emails.  This worker should be started on boot, and restarted if it fails.  For that we’re using supervisor (<a href="https://docs.inventree.org/en/latest/start/bare_prod/#configure-supervisor">docs</a>).  </p><pre><code>sudo apt-get install supervisor
cat &lt;&lt; EOF | sudo tee /etc/supervisor/conf.d/inventree.conf &gt; /dev/null
; # Supervisor Config File
; Example configuration file for running InvenTree worker using supervisor
; Based on https://github.com/inventree/InvenTree/blob/master/contrib/deploy/supervisord.conf

; InvenTree Background Worker Process
; A background task manager processes long-running and periodic tasks
; InvenTree uses django-q for this purpose
[program:inventree-cluster]
user=uwsgi
directory=/home/inventree/src/src/backend/InvenTree
command=/home/inventree/env/bin/python manage.py qcluster
startsecs=10
autostart=true
autorestart=true
stdout_logfile=/var/log/uwsgi/app/inventree-worker.log
stderr_logfile=/var/log/uwsgi/app/inventree-worker-err.log
EOF

cat &lt;&lt; EOF | sudo tee /etc/supervisor/conf.d/inet_http_server.conf &gt; /dev/null
[inet_http_server]
port = 127.0.0.1:9001
EOF

sudo systemctl reload supervisor
</code></pre>
<p>Logs for the worker can be viewed here:
<a href="http://localhost:9001/">http://localhost:9001/</a>
… where <code>localhost</code> is the inventree server.  Since that port is only available locally on the server, you’ll need to use <code>ssh -L</code> or similar to get the HTTP request forwarded from your machine to the server, or use the <code>links</code> text browser.</p><h2 id="install-redis">Install redis?</h2>
<p>If redis is installed, it will be used by the backend web code to communicate to the backend worker code.  If it’s not there, things will still work, but slower.  Symptoms are long waits for worker stuff to happen.  </p><pre><code>## So let&#39;s not
# sudo apt install redis-server
</code></pre>
<h2 id="setting-up-uwsgi-app-server">Setting up uWSGI (app server)</h2>
<p>It is assumed that the <code>uwsgi-emperor</code> package has already been installed, and it’s up and running the portal.</p><pre><code>cat &lt;&lt; EOF | sudo tee /etc/uwsgi-emperor/vassals-available/inventree.ini &gt; /dev/null
[uwsgi]
plugin = python3
chdir = /home/inventree/src/src/backend/InvenTree
virtualenv = /home/inventree/env
# /home/inventree/src/src/backend/InvenTree/InvenTree/wsgi.py
module = InvenTree.wsgi:application

master = true
processes = 2
enable-threads = true

cheaper = 1
cheaper-initial = 0
cheaper-min = 0
cheaper-max = 4
cheaper-algo = spare

# idle = 60
# die-in-idle = true

http-socket = /run/uwsgi/%n.sock
chmod-socket = 660
chown-socket = uwsgi:www-data
uid = uwsgi
gid = www-data

vacuum = true
die-on-term = true

# Optional logging:
logto = /var/log/uwsgi/app/%n.log
EOF

sudo ln -sf ../vassals-available/inventree.ini /etc/uwsgi-emperor/vassals-enabled/inventree.ini 
</code></pre>
<p>Check that the app server is now running.  Example:</p><pre><code>inventree@portal:~$ ps aux | grep uwsgi-core | grep inventree.ini
wsgi      67994 86.1 15.9 230520 157424 ?       R    15:07   0:19 /usr/bin/uwsgi-core --ini inventree.ini

inventree@portal:~$ 
</code></pre>
<p>Check also for the existence of <code>/var/run/uwsgi/inventree.sock</code>.</p><p>The uWSGI log can be viewed with:</p><pre><code>sudo journalctl -u uwsgi-emperor
</code></pre>
<p>Add <code>-f</code> to tail the log.</p><h2 id="setting-up-caddy-web-proxy">Setting up caddy (web proxy)</h2>
<p>Amend <code>/etc/caddy/Caddyfile</code> to add this:</p><pre><code># CORS headers control (used for static and media files)
(cors-headers) {
    header Allow GET,HEAD,OPTIONS
    header Access-Control-Allow-Origin *
    header Access-Control-Allow-Methods GET,HEAD,OPTIONS
    header Access-Control-Allow-Headers Authorization,Content-Type,User-Agent
 
    @cors_preflight{args[0]} method OPTIONS
 
    handle @cors_preflight{args[0]} {
        respond &quot;&quot; 204
    }
}

itree.example.com {
        log {
                output file /var/log/caddy/itree.log
                format filter {
                        wrap console
                        fields {
                                request&gt;headers&gt;Authorization delete
                        }
                }
        }

        encode gzip

        # Add request body size limit for file uploads
        request_body {
                max_size 100MB
        }

        header {
                Strict-Transport-Security max-age=31536000;
        }

        handle /favicon.ico {
                root * /home/inventree/data/static/img/favicon
                file_server
        }

        handle_path /static/* {
                import cors-headers static
                root * /home/inventree/data/static
                file_server
        }

        handle_path /media/* {
                import cors-headers media
                root * /home/inventree/data/media
                file_server
                # Authentication for media files
                forward_auth unix//run/uwsgi/inventree.sock {
                        uri /auth/
                }
        }

        reverse_proxy unix//run/uwsgi/inventree.sock
}

# Refer to the Caddy docs for more information:
# https://caddyserver.com/docs/caddyfile
</code></pre>
<p>Note: Change <code>itree.example.com</code> to a suitable hostname.  You’ll also need to create A or CNAME DNS records for this host. </p><p>(Basis: <a href="https://github.com/inventree/inventree/blob/master/contrib/container/Caddyfile">https://github.com/inventree/inventree/blob/master/contrib/container/Caddyfile</a>)</p><p>Restart caddy:</p><pre><code>sudo systemctl reload caddy
</code></pre>
<p>The caddy log can be viewed with:</p><pre><code>sudo journalctl -u caddy
</code></pre>
<p>Add <code>-f</code> to tail the log.</p><h2 id="todo">TODO</h2>
<ul>
<li>Backups - need to check whether the Inventree worker is kicking off backups.<br><a href="https://docs.inventree.org/en/latest/start/backup/#daily-backup">https://docs.inventree.org/en/latest/start/backup/#daily-backup</a></li>
</ul>

            ]]>
        </content>
    </entry>
</feed>
