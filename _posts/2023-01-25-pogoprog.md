---
layout: post
title: Programming ATmega chips with a home-made ISP
---
This post has been a long time coming! I originally pencilled it out
this time last year, but didn't finish it because I wanted to wait until
I had the PCBs to complete the programmer.

I guess my end goal is to program the two ATmega328P chips on _ozhelm_,
my autopilot project.  To save time and money, I'd ideally like to be
able to program them without adding any hardware to the board (such as
the 2x3 pin headers common in the AVR world).  To experiment with this,
I added three different programming footprints to the board:

* a standard 2.54mm pitch AVR 2x3 pin header as a fall-back,
* A 1.27mm pitch SOICbite, and
* A custom footprint based on a 1.27mm pitch 6x2 pogo pin jig from
AliExpress.

TODO: Insert pic of ozhelm board here

While the footprints are different, all three bring out the same six
standard programming signals from the ATmega.  For a programmer, I'll
use an ISP (In-System Programmer, so-called because you can program a
chip without removing it from the circuit board) constructed from an
Arduino nano running ArduinoISP firmware.  It's cool that one device
can program another!

The SOICbite method relies on a programming clip for a SOIC-8, available
from AliExpress, which is then clipped to the edge of the board:

TODO: Link to SOICbite website

TODO: Insert pic from AliExpress

I bought one and quickly abandoned the idea, because the clip just
doesn't locate positively onto the board edge.  

The next method I tried was with a pogo pin clip.  These are available
in a range of pitches, and I chose 1.27mm.

  https://www.aliexpress.com/item/1005004383550982.html

The clip supports an array of 2x6 pogo pins, and as you can see from J4
on my circuit board above, I chose to use six pins: Two at each end for
power, then another four for the other programming signals offset to
the power pins.

TODO: Insert closeup, perhaps from KiCad

In 2022, I did manage to use this clip to program the board, although
the solution was pretty janky:

TODO: Insert pic of jank.

I'm using some recycled ribbon cable to connect the clip to the nano
that will act as an ISP.  Glued to the side of the nano are three of my
little LED test boards.  These test boards can carry an LED (0603, 0805
or 1206 package) and dropper resistor (same sizes).  The ISP needs
three LEDs, so there's three boards.  I've had to put Blu Tack over one
of the LEDs because it's insanely bright!  (More about this later)

The other part to note is a 100n capacitor between RESET and GND.  This
is necessary to stop your computer from resetting the nano when it's
being used as an ISP.  You have to remove the cap to program the nano,
and reattach it for use as an ISP.

While this solution did work, the wires were prone to breaking, and the
LEDs and cap hanging off the side were ugly.  What I'd like is a small
PCB which goes between the clip and the nano.  The PCB would also have
the LEDs/resistors, and the capacitor, with no ugly or fragile wires.

I designed the first version of this in May last year, but made several
mistakes.  I 


TODO: Cap or resistor?


TODO: LED brightness

TODO: TagConnect
